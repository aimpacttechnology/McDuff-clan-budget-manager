<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <title>Budget Manager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
        h1 { font-size: 32px; font-weight: bold; color: #1F2937; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        h2 { font-size: 24px; font-weight: bold; color: #1F2937; margin-bottom: 16px; }
        h3 { font-size: 18px; font-weight: bold; color: #1F2937; margin-bottom: 12px; margin-top: 24px; }
        .subtitle { color: #6B7280; margin-bottom: 24px; }
        textarea { width: 100%; height: 120px; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-family: monospace; font-size: 14px; resize: vertical; }
        .paste-area { background: #EFF6FF; border: 2px dashed #60A5FA; border-radius: 8px; padding: 24px; margin-bottom: 24px; }
        .hint { color: #6B7280; font-size: 14px; margin-top: 8px; }
        .button { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .button:disabled { opacity: 0.5; cursor: not-allowed; }
        .button-green { background: #10B981; color: white; }
        .button-green:hover:not(:disabled) { background: #059669; }
        .button-red { background: #EF4444; color: white; }
        .button-red:hover:not(:disabled) { background: #DC2626; }
        .button-blue { background: #6366F1; color: white; }
        .button-blue:hover:not(:disabled) { background: #4F46E5; }
        .button-group { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-card { border-radius: 12px; padding: 20px; color: white; }
        .stat-card.green { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
        .stat-card.red { background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); }
        .stat-card.blue { background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }
        .stat-card.orange { background: linear-gradient(135deg, #F97316 0%, #EA580C 100%); }
        .stat-card.teal { background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%); }
        .stat-label { opacity: 0.9; font-size: 13px; margin-bottom: 6px; }
        .stat-value { font-size: 28px; font-weight: bold; }
        .stat-sub { font-size: 12px; opacity: 0.9; margin-top: 4px; }
        .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .budget-item { border: 1px solid #E5E7EB; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .budget-item.fixed { background: #F9FAFB; }
        .budget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .budget-name { font-weight: 600; color: #1F2937; }
        .budget-amount { font-family: monospace; font-size: 14px; color: #6B7280; }
        .progress-bar { width: 100%; height: 16px; background: #E5E7EB; border-radius: 8px; overflow: hidden; margin-bottom: 4px; }
        .progress-fill { height: 100%; transition: width 0.3s; }
        .progress-fill.green { background: #10B981; }
        .progress-fill.yellow { background: #F59E0B; }
        .progress-fill.red { background: #EF4444; }
        .progress-fill.gray { background: #6B7280; }
        .progress-text { font-size: 12px; color: #6B7280; display: flex; justify-content: space-between; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #E5E7EB; font-weight: 600; color: #1F2937; background: #F9FAFB; }
        td { padding: 12px; border-bottom: 1px solid #F3F4F6; }
        tr:hover { background: #F9FAFB; }
        .category-tag { display: inline-block; padding: 4px 12px; background: #EEF2FF; color: #6366F1; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .amount { font-family: monospace; font-weight: 600; }
        .amount.positive { color: #10B981; }
        .amount.negative { color: #EF4444; }
        .status-msg { position: fixed; top: 20px; right: 20px; background: #10B981; color: white; padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; }
        .edit-input { width: 100px; padding: 4px 8px; border: 1px solid #D1D5DB; border-radius: 4px; }
        .hidden { display: none; }
        .projection-table { margin-top: 24px; }
        .projection-table th { text-align: right; }
        .projection-table td { text-align: right; font-family: monospace; }
        .projection-table td:first-child { text-align: left; font-family: inherit; }
        .total-row { font-weight: bold; background: #F3F4F6; }
        @media (max-width: 968px) {
            .two-column { grid-template-columns: 1fr; }
            .stats { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 640px) {
            .stats { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üí∞ Budget Manager</h1>
            <div id="status" class="status-msg hidden"></div>
            <p class="subtitle">Track income, fixed expenses, and variable spending</p>
            
            <div class="paste-area">
                <textarea id="pasteArea" placeholder="Paste your transaction data here (with tabs between columns)...

Example format:
Date	Description	Category	Amount
December 12, 2025	H-E-B	Groceries	163.54"></textarea>
                <p class="hint">üí° Copy from Excel/Sheets, paste here, then click Import</p>
            </div>

            <div class="button-group">
                <button id="importBtn" class="button button-blue">üì• Import Transactions</button>
                <button id="exportBtn" class="button button-green" disabled>‚¨áÔ∏è Export CSV</button>
                <button id="clearBtn" class="button button-red" disabled>üóëÔ∏è Clear Transactions</button>
                <button id="editIncomeBtn" class="button button-purple">‚úèÔ∏è Edit Income & Fixed</button>
            </div>

            <div class="stats">
                <div class="stat-card green">
                    <div class="stat-label">Monthly Income</div>
                    <div class="stat-value" id="totalIncome">$0.00</div>
                    <div class="stat-sub">Total earnings</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-label">Fixed Expenses</div>
                    <div class="stat-value" id="totalFixed">$0.00</div>
                    <div class="stat-sub">Non-discretionary</div>
                </div>
                <div class="stat-card teal">
                    <div class="stat-label">Available to Budget</div>
                    <div class="stat-value" id="availableBudget">$0.00</div>
                    <div class="stat-sub">After fixed expenses</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-label">Variable Budget</div>
                    <div class="stat-value" id="totalVariableBudget">$0.00</div>
                    <div class="stat-sub">Planned spending</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-label">Variable Spent</div>
                    <div class="stat-value" id="totalVariableSpent">$0.00</div>
                    <div class="stat-sub" id="txCount">0 transactions</div>
                </div>
                <div class="stat-card blue" id="remainingCard">
                    <div class="stat-label">Net Position</div>
                    <div class="stat-value" id="netPosition">$0.00</div>
                    <div class="stat-sub" id="netStatus">-</div>
                </div>
            </div>
        </div>

        <!-- Projection Table -->
        <div class="card">
            <h2>üìä Monthly Budget Summary</h2>
            <table class="projection-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Budgeted</th>
                        <th>Actual</th>
                        <th>Difference</th>
                    </tr>
                </thead>
                <tbody id="projectionTable"></tbody>
            </table>
        </div>

        <div class="two-column">
            <!-- Fixed Expenses -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h2>üîí Fixed Expenses</h2>
                </div>
                <div id="fixedList"></div>
                <div style="margin-top: 16px; padding-top: 16px; border-top: 2px solid #E5E7EB;">
                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 18px;">
                        <span>Total Fixed:</span>
                        <span id="fixedTotal" style="font-family: monospace;">$0.00</span>
                    </div>
                </div>
            </div>

            <!-- Variable Budget -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h2>üìù Variable Budget</h2>
                    <button id="editVariableBtn" class="button button-blue">Edit</button>
                </div>
                <div id="variableList"></div>
                <div style="margin-top: 16px; padding-top: 16px; border-top: 2px solid #E5E7EB;">
                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 18px;">
                        <span>Total Budget:</span>
                        <span id="variableTotal" style="font-family: monospace;">$0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions -->
        <div class="card" id="transactionCard" style="display: none;">
            <h2>All Transactions (<span id="txTotal">0</span>)</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Merchant</th>
                            <th>Category</th>
                            <th style="text-align: right;">Amount</th>
                        </tr>
                    </thead>
                    <tbody id="transactionTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let transactions = [];
        let income = {
            'Salary': 5900,
            'Other Income': 0
        };
        let fixedExpenses = {
            'Rent/Mortgage': 2300,
            'Vehicle A Payment': 500,
            'Vehicle B Payment': 680,
            'Insurance': 0,
            'Phone & Internet': 180,
            'Utilities (Power/Water)': 0
        };
        let variableBudgets = {
            'Groceries': 600,
            'Restaurants/Dining': 300,
            'Gasoline/Fuel': 200,
            'General Merchandise': 300,
            'Entertainment': 150,
            'Personal Care': 100,
            'Clothing/Shoes': 100,
            'Online Services': 50,
            'Pets/Pet Care': 75,
            'Other Expenses': 200,
            'Dues and Subscriptions': 25,
            'Service Charges/Fees': 25
        };
        let editModeVariable = false;

        function loadData() {
            const savedTx = localStorage.getItem('budget-transactions');
            const savedIncome = localStorage.getItem('budget-income');
            const savedFixed = localStorage.getItem('budget-fixed');
            const savedVariable = localStorage.getItem('budget-variable');
            
            if (savedTx) transactions = JSON.parse(savedTx);
            if (savedIncome) income = JSON.parse(savedIncome);
            if (savedFixed) fixedExpenses = JSON.parse(savedFixed);
            if (savedVariable) variableBudgets = JSON.parse(savedVariable);
            
            render();
        }

        function saveAll() {
            localStorage.setItem('budget-transactions', JSON.stringify(transactions));
            localStorage.setItem('budget-income', JSON.stringify(income));
            localStorage.setItem('budget-fixed', JSON.stringify(fixedExpenses));
            localStorage.setItem('budget-variable', JSON.stringify(variableBudgets));
        }

        function showStatus(msg) {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.classList.remove('hidden');
            setTimeout(() => status.classList.add('hidden'), 2000);
        }

        function parseTransactionData(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const parsed = [];
            let startIndex = lines[0] && lines[0].toLowerCase().includes('date') ? 1 : 0;
            
            for (let i = startIndex; i < lines.length; i++) {
                const parts = lines[i].split('\t');
                if (parts.length >= 4) {
                    const date = parts[0].trim();
                    const description = parts[1].trim();
                    const category = parts[2].trim();
                    const amount = parseFloat(parts[3].trim().replace(/[,$]/g, ''));
                    
                    const skipCategories = ['Paychecks/Salary', 'Deposits', 'Transfers', 'POS'];
                    if (skipCategories.includes(category) || isNaN(amount) || amount === 0) continue;
                    
                    let merchant = description
                        .replace(/^(POS Debit|Pos Debit|DEBIT-DC|Payment to|-)\s*-?\s*\d*\s*/i, '')
                        .replace(/\s+(XX-\d+|[\dA-Z]{2,3}\s*(US|AU|CY)).*$/i, '')
                        .trim();
                    
                    if (!merchant) merchant = description;
                    
                    parsed.push({ date: date || 'Unknown', merchant, category, amount, id: Date.now() + Math.random() + i });
                }
            }
            return parsed;
        }

        document.getElementById('importBtn').addEventListener('click', () => {
            const text = document.getElementById('pasteArea').value;
            if (!text.trim()) {
                alert('Please paste your transaction data first!');
                return;
            }
            const newTx = parseTransactionData(text);
            if (newTx.length === 0) {
                alert('No transactions found. Make sure your data has Date, Description, Category, and Amount columns separated by tabs.');
                return;
            }
            transactions = [...newTx, ...transactions];
            saveAll();
            showStatus(`Added ${newTx.length} transactions!`);
            document.getElementById('pasteArea').value = '';
            render();
        });

        document.getElementById('exportBtn').addEventListener('click', () => {
            const csv = [['Date', 'Merchant', 'Category', 'Amount'], ...transactions.map(t => [t.date, t.merchant, t.category, t.amount])].map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'budget-transactions.csv';
            a.click();
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            if (confirm('Clear all transactions?')) {
                transactions = [];
                saveAll();
                showStatus('Transactions cleared');
                render();
            }
        });

        document.getElementById('editIncomeBtn').addEventListener('click', () => {
            const incomeStr = Object.entries(income).map(([k,v]) => `${k}: ${v}`).join('\n');
            const fixedStr = Object.entries(fixedExpenses).map(([k,v]) => `${k}: ${v}`).join('\n');
            
            const newIncome = prompt('Edit Income (format: "Name: Amount"):\n\n' + incomeStr);
            if (newIncome !== null) {
                income = {};
                newIncome.split('\n').forEach(line => {
                    const parts = line.split(':');
                    if (parts.length === 2) {
                        income[parts[0].trim()] = parseFloat(parts[1].trim()) || 0;
                    }
                });
            }
            
            const newFixed = prompt('Edit Fixed Expenses (format: "Name: Amount"):\n\n' + fixedStr);
            if (newFixed !== null) {
                fixedExpenses = {};
                newFixed.split('\n').forEach(line => {
                    const parts = line.split(':');
                    if (parts.length === 2) {
                        fixedExpenses[parts[0].trim()] = parseFloat(parts[1].trim()) || 0;
                    }
                });
            }
            
            saveAll();
            render();
        });

        document.getElementById('editVariableBtn').addEventListener('click', () => {
            editModeVariable = !editModeVariable;
            document.getElementById('editVariableBtn').textContent = editModeVariable ? 'Done' : 'Edit';
            renderVariable();
        });

        function calculateTotals() {
            const totalIncome = Object.values(income).reduce((sum, val) => sum + val, 0);
            const totalFixed = Object.values(fixedExpenses).reduce((sum, val) => sum + val, 0);
            const totalVariableBudget = Object.values(variableBudgets).reduce((sum, val) => sum + val, 0);
            
            const categorySpent = {};
            transactions.forEach(t => {
                categorySpent[t.category] = (categorySpent[t.category] || 0) + t.amount;
            });
            const totalVariableSpent = Object.values(categorySpent).reduce((sum, val) => sum + val, 0);
            
            const availableBudget = totalIncome - totalFixed;
            const netPosition = availableBudget - totalVariableSpent;
            
            return { totalIncome, totalFixed, totalVariableBudget, totalVariableSpent, availableBudget, netPosition, categorySpent };
        }

        function render() {
            const { totalIncome, totalFixed, totalVariableBudget, totalVariableSpent, availableBudget, netPosition, categorySpent } = calculateTotals();
            
            document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('totalFixed').textContent = `$${totalFixed.toFixed(2)}`;
            document.getElementById('availableBudget').textContent = `$${availableBudget.toFixed(2)}`;
            document.getElementById('totalVariableBudget').textContent = `$${totalVariableBudget.toFixed(2)}`;
            document.getElementById('totalVariableSpent').textContent = `$${totalVariableSpent.toFixed(2)}`;
            document.getElementById('txCount').textContent = `${transactions.length} transactions`;
            document.getElementById('netPosition').textContent = `$${netPosition.toFixed(2)}`;
            document.getElementById('netStatus').textContent = netPosition >= 0 ? '‚úì Positive' : '‚ö†Ô∏è Negative';
            
            const remainingCard = document.getElementById('remainingCard');
            remainingCard.className = netPosition >= 0 ? 'stat-card blue' : 'stat-card orange';
            
            document.getElementById('exportBtn').disabled = transactions.length === 0;
            document.getElementById('clearBtn').disabled = transactions.length === 0;
            
            renderFixed();
            renderVariable(categorySpent);
            renderProjection(categorySpent);
            renderTransactions();
        }

        function renderFixed() {
            const list = document.getElementById('fixedList');
            const totalFixed = Object.values(fixedExpenses).reduce((sum, val) => sum + val, 0);
            
            list.innerHTML = Object.entries(fixedExpenses).map(([name, amount]) => `
                <div class="budget-item fixed">
                    <div class="budget-header">
                        <span class="budget-name">${name}</span>
                        <span class="budget-amount" style="color: #EF4444;">-$${amount.toFixed(2)}</span>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('fixedTotal').textContent = `$${totalFixed.toFixed(2)}`;
        }

        function renderVariable(categorySpent = {}) {
            const list = document.getElementById('variableList');
            const totalBudget = Object.values(variableBudgets).reduce((sum, val) => sum + val, 0);
            
            list.innerHTML = Object.entries(variableBudgets).sort().map(([name, budget]) => {
                const spent = categorySpent[name] || 0;
                const percentage = budget > 0 ? (spent / budget) * 100 : 0;
                const isOverBudget = spent > budget;
                const color = isOverBudget ? 'red' : percentage > 75 ? 'yellow' : 'green';
                
                return `
                    <div class="budget-item">
                        <div class="budget-header">
                            <span class="budget-name">${name}</span>
                            ${editModeVariable ? 
                                `<div><span style="color: #6B7280; font-size: 14px;">$</span><input type="number" class="edit-input" value="${budget}" data-category="${name}"></div>` :
                                `<span class="budget-amount">$${spent.toFixed(2)} / $${budget.toFixed(2)}</span>`
                            }
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${color}" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <div class="progress-text">
                            <span>${percentage.toFixed(1)}% used</span>
                            ${isOverBudget ? `<span style="color: #EF4444; font-weight: 600;">‚ö†Ô∏è Over by $${(spent - budget).toFixed(2)}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('variableTotal').textContent = `$${totalBudget.toFixed(2)}`;
            
            if (editModeVariable) {
                document.querySelectorAll('.edit-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const category = e.target.dataset.category;
                        variableBudgets[category] = parseFloat(e.target.value) || 0;
                        saveAll();
                        render();
                    });
                });
            }
        }

        function renderProjection(categorySpent) {
            const { totalIncome, totalFixed, totalVariableBudget, totalVariableSpent, availableBudget, netPosition } = calculateTotals();
            const table = document.getElementById('projectionTable');
            
            let html = `
                <tr class="total-row">
                    <td>üí∞ Total Income</td>
                    <td class="amount positive">$${totalIncome.toFixed(2)}</td>
                    <td class="amount positive">$${totalIncome.toFixed(2)}</td>
                    <td>-</td>
                </tr>
                <tr class="total-row">
                    <td>üîí Fixed Expenses</td>
                    <td class="amount negative">-$${totalFixed.toFixed(2)}</td>
                    <td class="amount negative">-$${totalFixed.toFixed(2)}</td>
                    <td>$0.00</td>
                </tr>
                <tr class="total-row" style="background: #E0E7FF;">
                    <td><strong>= Available for Variable Spending</strong></td>
                    <td><strong class="amount">$${availableBudget.toFixed(2)}</strong></td>
                    <td>-</td>
                    <td>-</td>
                </tr>
            `;
            
            Object.entries(variableBudgets).sort().forEach(([name, budget]) => {
                const spent = categorySpent[name] || 0;
                const diff = budget - spent;
                html += `
                    <tr>
                        <td>${name}</td>
                        <td>$${budget.toFixed(2)}</td>
                        <td class="amount negative">$${spent.toFixed(2)}</td>
                        <td class="amount ${diff >= 0 ? 'positive' : 'negative'}">${diff >= 0 ? '$' : '-$'}${Math.abs(diff).toFixed(2)}</td>
                    </tr>
                `;
            });
            
            html += `
                <tr class="total-row">
                    <td><strong>Total Variable</strong></td>
                    <td><strong>$${totalVariableBudget.toFixed(2)}</strong></td>
                    <td><strong class="amount negative">$${totalVariableSpent.toFixed(2)}</strong></td>
                    <td><strong class="amount ${totalVariableBudget - totalVariableSpent >= 0 ? 'positive' : 'negative'}">${totalVariableBudget - totalVariableSpent >= 0 ? '$' : '-$'}${Math.abs(totalVariableBudget - totalVariableSpent).toFixed(2)}</strong></td>
                </tr>
                <tr class="total-row" style="background: ${netPosition >= 0 ? '#D1FAE5' : '#FEE2E2'};">
                    <td><strong>üìä NET POSITION</strong></td>
                    <td><strong>-</strong></td>
                    <td><strong>-</strong></td>
                    <td><strong class="amount ${netPosition >= 0 ? 'positive' : 'negative'}" style="font-size: 18px;">${netPosition >= 0 ? '$' : '-$'}${Math.abs(netPosition).toFixed(2)}</strong></td>
                </tr>
            `;
            
            table.innerHTML = html;
        }

        function renderTransactions() {
            const table = document.getElementById('transactionTable');
            const card = document.getElementById('transactionCard');
            
            if (transactions.length === 0) {
                card.style.display = 'none';
                return;
            }
            
            card.style.display = 'block';
            document.getElementById('txTotal').textContent = transactions.length;
            
            table.innerHTML = transactions.map(t => `
                <tr>
                    <td style="color: #6B7280; font-size: 14px;">${t.date}</td>
                    <td style="color: #1F2937;">${t.merchant}</td>
                    <td><span class="category-tag">${t.category}</span></td>
                    <td style="text-align: right;"><span class="amount negative">$${t.amount.toFixed(2)}</span></td>
                </tr>
            `).join('');
        }

        loadData();
    </script>
</body>
</html>
